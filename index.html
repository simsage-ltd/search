<!DOCTYPE html>
<html lang="en">
<head>
	<title>SimSearch UI</title>
	 <script src="js/jquery-3.4.1.min.js"></script>
    <script src="settings.js"></script>
    <script src="search_settings.js"></script>
    <script src="js/semantic_search.js"></script>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <meta charset="UTF-8">
</head>
<body>

<div class="logo-container">
	<img alt="SimSearch Logo" src="images/logo.svg" class="logo" />
</div>

<div class="query-area">

    <div class="search-container">
        <label for="searchText"></label>
        <input type="text" class="query-box"
               title="your keywords" id="searchText" onkeypress="search_enter(event)" />
        <input id="btnSearch" type="button" value="search" class="query-button" onclick="search_click()" />
        <input type="button" class="toggle-advanced-search-button" value="..." title="toggle advanced search" onclick="advanced_search_click(event)" />
        <div class="advanced-search-tick"><img class="advanced-search-tick-image" src="images/tick.svg" alt="selected" title="advanced search active" /></div>
    </div>

    <div class="search-area">
        <div class="result-count" id="result-count"></div>
        <div class="answer-container" id="search_results">
        </div>
    </div>
    <div class="search-summary">
        <div class="result-page" id="result-page"></div>
    </div>

    <div class="metadata-area" id="advancedSearch">
        <div class="metadata-title">advanced search</div>
        <div class="metadata-url">
            <label class="search-label" for="txtTitle">title</label>
            <input id="txtTitle" class="metadata-text" placeholder="title filter" type="text" onkeyup="change_advanced_search()" />
        </div>
        <div class="metadata-url">
            <label class="search-label" for="txtUrl">url</label>
            <input id="txtUrl" class="metadata-text" placeholder="url filter" type="text" onkeyup="change_advanced_search()" />
        </div>
        <div class="metadata-author">
            <label class="search-label" for="txtAuthor">author</label>
            <input id="txtAuthor" class="metadata-text" placeholder="author filter" type="text" onkeyup="change_advanced_search()" />
        </div>
        <div class="metadata-type">
            <label class="search-label" for="txtTypeFilter">document type</label>
            <select id="txtTypeFilter" name="document-type" onchange="change_advanced_search()">
                <option value="">not selected</option>
                <option value="html,htm">web pages</option>
                <option value="doc,docx">word documents</option>
                <option value="pdf">PDF documents</option>
                <option value="xls,xlsx">spreadsheets</option>
                <option value="jpg,jpeg,png,gif">images</option>
            </select>
        </div>
        <div class="metadata-buttons">
            <input type="button" class="metadata-button-clear" value="clear" title="clear all filters" onclick="advanced_search_clear_click()" />
        </div>
    </div>

</div>


<script>
    var searchText = $("#searchText");
    searchText.focus();

    // callback to change html-dom if it needs changing
    function update_ui(search) {
        if (search.error.length > 0) {
            alert(search.error);
        } else {
            $("#search_results").html(search.get_semantic_search_html());
        }
        if (search.busy) {
            searchText.attr("disabled", "true");
            $("#btnSearch").attr("disabled", "true");
        } else {
            searchText.removeAttr("disabled");
            $("#btnSearch").removeAttr("disabled");
        }
        if (semantic_search.num_results > 0) {
            $("#result-page").html("page " + (semantic_search.page + 1) + " of " + this.num_pages);
            $("#result-count").html("" + semantic_search.num_results + " results");
        } else if (semantic_search.num_results === 0) {
            $("#result-page").html("");
            $("#result-count").html("no results");
        }
    }

    const semantic_search = new SemanticSearch(settings, update_ui);

    // pagination stubs used by generated render code
    function doInnerPrev(url) {
        semantic_search.doInnerPrev(url);
    }

    function doInnerNext(url) {
        semantic_search.doInnerNext(url);
    }

    function prevPage() {
        semantic_search.prevPage();
    }

    function nextPage() {
        semantic_search.nextPage();
    }

    function openUrl(url) {
        window.open(url, '_blank');
    }

    // semantic search enter key check
    function search_enter(event) {
        if (event.keyCode === 13) {
            search_click();
        }
    }

    // do a semantic search
    function search_click() {
        const search_text = searchText.val();
        if (search_text.length > 1) {
            semantic_search.page = 0;  // reset to page 0
            semantic_search.do_semantic_search(search_text);
        } else {
            alert('please enter a search query');
        }
    }

    function advanced_search_click() {
        const as = $("#advancedSearch");
        if (as.css("display") === "none") {
            as.show();
            $("#txtTitle").focus();
        } else {
            as.hide();
            $("#searchText").focus();
        }
    }

    function advanced_search_clear_click() {
        $("#txtTypeFilter").val("");
        $("#txtTitle").val("");
        $("#txtUrl").val("");
        $("#txtAuthor").val("");
        change_advanced_search();
    }

    function change_advanced_search() {
        semantic_search.fileType = [];
        semantic_search.url = [];
        semantic_search.title = [];
        semantic_search.author = [];

        const titleFilter = $("#txtTitle").val();
        const urlFilter = $("#txtUrl").val();
        const authorFilter = $("#txtAuthor").val();
        const typeFilter = $("#txtTypeFilter").val();
        if (typeFilter.length > 0 || urlFilter.length > 0 || authorFilter.length > 0 || titleFilter.length > 0) {
            $(".advanced-search-tick").css("display", "inline-block");

            if (typeFilter.length > 0)
                semantic_search.fileType = typeFilter.split(",");
            if (urlFilter.length > 0)
                semantic_search.url = urlFilter.split(",");
            if (titleFilter.length > 0)
                semantic_search.title = titleFilter.split(",");
            if (authorFilter.length > 0)
                semantic_search.author = authorFilter.split(",");

        } else {
            $(".advanced-search-tick").css("display", "none");
        }
    }


</script>

</body>
</html>
