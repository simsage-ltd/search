<html lang="en">
<head>
	<title>SimSage Search</title>

	<script src="js/jquery-3.4.1.min.js"></script>
	<script src="js/template.js"></script>
	<script src="settings.js"></script>
	<script src="search_settings.js"></script>
	<script src="js/semantic_search.js"></script>

	<link rel="stylesheet" type="text/css" href="css/search.css">
</head>
<body class="body-style">

	<div class="view-type-container">
		<div class="view-type" title="text view" onclick="search.text_view()">
			<img src="images/text-lines.svg" class="view-image-1" alt="text view" onclick="search.text_view()" />
		</div>
		<div class="view-type" title="image view" onclick="search.image_view()">
			<img src="images/view.svg" class="view-image-2" alt="image view" onclick="search.image_view()" />
		</div>
	</div>

	<div class="centered-page">
		<div class="search-control">
			<div class="advanced-search" title="advanced search" onclick="advanced_search_click()">
				<div id="advancedSearchButton" class="select-style"><div class="select-text">filter</div>
					<div class="select-triangle">
						<img src="images/down-triangle.svg" alt="select" class="triangle-image">
					</div>
				</div>
			</div>
			<div class="search-text-box">
				<input type="text" class="input-text" id="txtSearch" onclick="search.hide_advanced_search()" onkeypress="search_enter(event)">
			</div>
			<div id="btnSearch" class="search-button-box" title="search" onclick="search_click()">
				<img src="images/search.svg" class="search-image" alt="search" onclick="search_click()">
			</div>
		</div>
	</div>


	<div class="centered-page">
		<div id="advancedSearch" class="metadata-area" style="display: none;">
			<div class="floaty">
				<div class="metadata-type">
					<label class="search-label" for="txtTypeFilter">document type</label>
					<select id="txtTypeFilter" name="document-type" class="select" onchange="change_advanced_search()">
						<option value="">not selected</option>
						<option value="html,htm">web pages</option>
						<option value="doc,docx">word documents</option>
						<option value="pdf">PDF documents</option>
						<option value="xls,xlsx">spreadsheets</option>
						<option value="jpg,jpeg,png,gif">images</option>
					</select>
				</div>
				<div class="metadata-type">
					<label class="search-label" for="ddKnowledgeBase">knowledge base</label>
					<select id="ddKnowledgeBase" name="knowledge-base" class="select" onchange="change_advanced_search()">
					</select>
				</div>
				<div class="metadata-type">
					<label class="search-label" for="ddSource">source</label>
					<select id="ddSource" name="source" class="select" onchange="change_advanced_search()">
					</select>
				</div>
				<div class="metadata-url">
					<label class="search-label" for="txtTitle">title</label>
					<input id="txtTitle" class="metadata-text" placeholder="title filter" type="text" onkeyup="change_advanced_search()" />
				</div>
				<div class="metadata-url">
					<label class="search-label" for="txtUrl">url</label>
					<input id="txtUrl" class="metadata-text" placeholder="url filter" type="text" onkeyup="change_advanced_search()" />
				</div>
				<div class="metadata-author">
					<label class="search-label" for="txtAuthor">author</label>
					<input id="txtAuthor" class="metadata-text" placeholder="author filter" type="text" onkeyup="change_advanced_search()" />
				</div>
				<div class="metadata-buttons">
					<div class="metadata-button-clear" title="clear all filters" onclick="advanced_search_clear_click()">clear</div>
				</div>
			</div>
		</div>
	</div>

	<br />
	<br />


	<div id="results" class="centered-page">
	</div>

	<!-- details page -->
	<div id="divDetails" class="details-page" style="display: none;">
	</div>

	<div class="powered-by" id="poweredBy">
		<img src="images/powered-by-simsage.svg" alt="powered by" title="powered by SimSage" />
	</div>

</body>

<script lang="javascript">

	const search_ctrl = $("#txtSearch");
	const dd_kb = $("#ddKnowledgeBase");
	const dd_source = $("#ddSource");
	const btn_search = $("#btnSearch");
	const results = $("#results");
	const details = $("#divDetails");
	const advanced_search = $("#advancedSearch");
	const poweredBy = $("#poweredBy");
	const advanced_search_button = $("#advancedSearchButton");

	search_ctrl.focus();

	function update_ui(search) {
        if (search.error.length > 0) {
            alert(search.error);
        } else {
        	const html = search.get_semantic_search_html();
            results.html(html);
        }
        if (this.semantic_search_results.length > 0) {
			poweredBy.hide();
		} else {
			poweredBy.show();
		}
        dd_kb.html(search.kbOptions());
        if (search.kb && search.kb.id) {
            dd_kb.val(search.kb.id);
        }
        dd_source.html(search.sourceOptions());
        if (search.source && search.source.id) {
            dd_source.val(search.source.id);
        }
        if (search.busy) {
            search_ctrl.attr("disabled", "true");
            btn_search.attr("disabled", "true");
        } else {
            search_ctrl.removeAttr("disabled");
            btn_search.removeAttr("disabled");
        }
        if (search.show_details) {
			details.html(search.details_html);
			details.show();
		} else {
			details.hide();
		}
        if (search.show_advanced_search) {
			advanced_search.show();
		} else {
			advanced_search.hide();
		}
        if (search.has_advanced_selection) {
			advanced_search_button.removeClass("select-style");
			advanced_search_button.addClass("select-style-has-selection");
		} else {
			advanced_search_button.removeClass("select-style-has-selection");
			advanced_search_button.addClass("select-style");
		}
		search_ctrl.focus();
	}

	const search = new SemanticSearch(settings, update_ui, search_ctrl);

	    // semantic search enter key check
    function search_enter(event) {
        if (event.keyCode === 13) {
            search_click();
        }
    }

    // do a semantic search
    function search_click() {
        const search_text = search_ctrl.val();
		search.reset_pagination();
		search.do_semantic_search(search_text);
    }

    function advanced_search_click() {
    	search.toggle_advanced_search();
    }

	function advanced_search_clear_click() {
		$("#txtTypeFilter").val("");
		$("#txtTitle").val("");
		$("#txtUrl").val("");
		$("#txtAuthor").val("");
		$("#ddSource").val("");
		change_advanced_search();
	}

	function change_advanced_search() {
		search.fileType = [];
		search.kb = null;
		search.source = null;
		search.url = [];
		search.title = [];
		search.author = [];
		search.source = '';
		search.has_advanced_selection = false;

		const titleFilter = $("#txtTitle").val();
		const urlFilter = $("#txtUrl").val();
		const authorFilter = $("#txtAuthor").val();
		const typeFilter = $("#txtTypeFilter").val();
		const kb = search.set_kb($("#ddKnowledgeBase").val());
		const source = search.set_source($("#ddSource").val());
		if (typeFilter.length > 0 || urlFilter.length > 0 || authorFilter.length > 0 || titleFilter.length > 0) {
			search.has_advanced_selection = true;
			$(".advanced-search-tick").css("display", "inline-block");
			if (typeFilter.length > 0)
				search.fileType = typeFilter.split(",");
			if (urlFilter.length > 0)
				search.url = urlFilter.split(",");
			if (titleFilter.length > 0)
				search.title = titleFilter.split(",");
			if (authorFilter.length > 0)
				search.author = authorFilter.split(",");
		} else {
			$(".advanced-search-tick").css("display", "none");
		}
	}

	// load initial document settings from server
    $( document ).ready(function() {
        search.getSemanticSearchInfo();
    });

</script>

</html>
